SELECT
    COALESCE(A.ORGANIZATION_ID, B.ORGANIZATION_ID) AS ORGANIZATION_ID,
    COALESCE(A.PROD_TYPE, B.PROD_TYPE) AS PROD_TYPE,
    COALESCE(A.LINE_TYPE, B.LINE_TYPE) AS LINE_TYPE,
    COALESCE(A.TRX_DATE, B.TRX_DATE) AS TRX_DATE,
    COALESCE(A.BATCH_NO, B.BATCH_NO) AS BATCH_NO,
    A.ITEM_CODE AS PRODUCT_ITEM_CODE,
    B.ITEM_CODE AS INPUT_ITEM_CODE,
    ABS(A.TOTAL_QTY) AS PRODUCT_QTY,
    ABS(B.TOTAL_QTY) AS INPUT_QTY
FROM
    (SELECT
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE,
        SUM(TRX_QTY) AS TOTAL_QTY
    FROM
        XXSRF.JUMBO_MET_TRANSACTIONS
    WHERE
        LINE_TYPE = 1
    GROUP BY
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE) A
FULL OUTER JOIN
    (SELECT
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE,
        SUM(TRX_QTY) AS TOTAL_QTY
    FROM
        XXSRF.JUMBO_MET_TRANSACTIONS
    WHERE
        LINE_TYPE = -1
    GROUP BY
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE) B
ON A.ORGANIZATION_ID = B.ORGANIZATION_ID
AND A.TRX_DATE = B.TRX_DATE
AND A.BATCH_NO = B.BATCH_NO
AND A.ITEM_CODE = B.ITEM_CODE
WHERE
    (A.ORGANIZATION_ID = :ORGANIZATION_ID OR B.ORGANIZATION_ID = :ORGANIZATION_ID)
AND (A.TRX_DATE = :TRX_DATE OR B.TRX_DATE = :TRX_DATE)
ORDER BY
    COALESCE(A.ORGANIZATION_ID, B.ORGANIZATION_ID),
    COALESCE(A.TRX_DATE, B.TRX_DATE),
    COALESCE(A.BATCH_NO, B.BATCH_NO),
    COALESCE(A.LINE_TYPE, B.LINE_TYPE);
