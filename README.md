Sure, let's properly format the `SET` clause to make it more readable:

```sql
WITH
    FREIGHT_DATA AS (
        SELECT 
            GCC.SEGMENT1 BUSINESS_UNIT,
            CASE
                WHEN TO_NUMBER(GCC.SEGMENT6) BETWEEN 15000 AND 15999 THEN 'BOPP'
                WHEN (TO_NUMBER(GCC.SEGMENT6) NOT BETWEEN 10101 AND 10111) AND TO_NUMBER(GCC.SEGMENT6) < 14999 THEN 'BOPET'
            END PROD,
            CASE
                WHEN GCC.SEGMENT3 = '414501' THEN 'COMMISSION'
                ELSE 'OTHER'
            END CATEGORY,
            NVL(SUM(ACCOUNTED_DR), 0) - NVL(SUM(ACCOUNTED_CR), 0) L_TOT_FREGHT_AMT
        FROM GL_JE_LINES GJL,
             GL_JE_HEADERS GJH,
             GL_LEDGERS GLL,
             GL_CODE_COMBINATIONS_KFV GCC,
             GL_PERIODS GP,
             HR_OPERATING_UNITS HOU
        WHERE GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
          AND GJH.LEDGER_ID = HOU.SET_OF_BOOKS_ID
          AND HOU.ORGANIZATION_ID = :P_ORG_ID
          AND GJL.PERIOD_NAME = GJH.PERIOD_NAME
          AND GJL.LEDGER_ID = GLL.LEDGER_ID
          AND GLL.LEDGER_CATEGORY_CODE(+) = 'PRIMARY'
          AND GJL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
          AND GJH.PERIOD_NAME = GP.PERIOD_NAME
          AND UPPER(GJH.PERIOD_NAME) IN (
              SELECT UPPER(PERIOD_NAME)
              FROM GL_PERIODS
              WHERE ADJUSTMENT_PERIOD_FLAG = 'Y'
                AND TO_CHAR(START_DATE, 'MON-RR') = UPPER(:P_PERIOD)
              UNION ALL
              SELECT UPPER(PERIOD_NAME)
              FROM GL_PERIODS
              WHERE 1 = 1
                AND UPPER(PERIOD_NAME) = UPPER(:P_PERIOD)
          )
          AND GCC.SEGMENT3 IN ('414501', '414601', '414603')
        GROUP BY 
            GCC.SEGMENT1,
            CASE
                WHEN TO_NUMBER(GCC.SEGMENT6) BETWEEN 15000 AND 15999 THEN 'BOPP'
                WHEN (TO_NUMBER(GCC.SEGMENT6) NOT BETWEEN 10101 AND 10111) AND TO_NUMBER(GCC.SEGMENT6) < 14999 THEN 'BOPET'
            END,
            CASE
                WHEN GCC.SEGMENT3 = '414501' THEN 'COMMISSION'
                ELSE 'OTHER'
            END
    ),
    VOLUME_DATA AS (
        SELECT 
            GCC.SEGMENT1 BUSINESS_UNIT,
            CASE
                WHEN TO_NUMBER(GCC.SEGMENT6) BETWEEN 15000 AND 15999 THEN 'BOPP'
                WHEN (TO_NUMBER(GCC.SEGMENT6) NOT BETWEEN 10101 AND 10111) AND TO_NUMBER(GCC.SEGMENT6) < 14999 THEN 'BOPET'
            END PROD,
            NVL(SUM(ACCOUNTED_DR), 0) - NVL(SUM(ACCOUNTED_CR), 0) L_OTHERTHAN_FREGHT_AMT
        FROM GL_JE_LINES GJL,
             GL_JE_HEADERS GJH,
             GL_LEDGERS GLL,
             GL_CODE_COMBINATIONS_KFV GCC,
             GL_PERIODS GP,
             HR_OPERATING_UNITS HOU
        WHERE GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
          AND GJH.LEDGER_ID = HOU.SET_OF_BOOKS_ID
          AND HOU.ORGANIZATION_ID = :P_ORG_ID
          AND GJL.PERIOD_NAME = GJH.PERIOD_NAME
          AND GJL.LEDGER_ID = GLL.LEDGER_ID
          AND GLL.LEDGER_CATEGORY_CODE(+) = 'PRIMARY'
          AND GJL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
          AND GJH.PERIOD_NAME = GP.PERIOD_NAME
          AND UPPER(GJH.PERIOD_NAME) IN (
              SELECT UPPER(PERIOD_NAME)
              FROM GL_PERIODS
              WHERE ADJUSTMENT_PERIOD_FLAG = 'Y'
                AND TO_CHAR(START_DATE, 'MON-RR') = UPPER(:P_PERIOD)
              UNION ALL
              SELECT UPPER(PERIOD_NAME)
              FROM GL_PERIODS
              WHERE 1 = 1
                AND UPPER(PERIOD_NAME) = UPPER(:P_PERIOD)
          )
          AND GCC.SEGMENT5 <> '2161'
          AND GCC.SEGMENT3 IN ('311111', '311112', '311118', '311119')
        GROUP BY 
            GCC.SEGMENT1,
            CASE
                WHEN TO_NUMBER(GCC.SEGMENT6) BETWEEN 15000 AND 15999 THEN 'BOPP'
                WHEN (TO_NUMBER(GCC.SEGMENT6) NOT BETWEEN 10101 AND 10111) AND TO_NUMBER(GCC.SEGMENT6) < 14999 THEN 'BOPET'
            END
    )
SELECT * FROM (
    SELECT 
        NPR.ORGANIZATION_ID,
        NPR.ORG_ID,
        NPR.BSV,
        NPR.ORGANIZATION_CODE,
        NPR.PRODUCT_SEGMENT,
        NPR.PERIOD_NAME,
        NPR.MIS_CATEGORY,
        NPR.TRX_DATE,
        NPR.TRX_NUMBER,
        NPR.MARKET_TYPE,
        NPR.ITEM_CODE,
        NPR.CUSTOMER_NAME,
        NPR.SALES_QTY_MT,
        NPR.SALE_VALUE,
        NPR.GROSS_NPR,
        ROUND(NPR.GROSS_NPR - ((NVL(VD.L_OTHERTHAN_FREGHT_AMT, 0) / NULLIF(SUM(NPR.SALES_QTY_MT), 0)) / 1000
             + (NVL(FD_OTHER.L_TOT_FREGHT_AMT, 0) / NULLIF(SUM(NPR.SALES_QTY_MT), 0)) / 1000), 2) AS NET_NPR,
        ROUND(NVL(FD_OTHER.L_TOT_FREGHT_AMT, 0) / NULLIF(SUM(NPR.SALES_QTY_MT) OVER () * 1000, 0), 4) AS FREIGHT_AND_HANDLING,
        ROUND(NVL(VD.L_OTHERTHAN_FREGHT_AMT, 0) / NULLIF(SUM(NPR.SALES_QTY_MT) OVER () * 1000, 0), 4) AS SPL_DISCOUNT,
        ROUND(NVL(FD_COMMISSION.L_TOT_FREGHT_AMT, 0) / NULLIF(SUM(NPR.SALES_QTY_MT) OVER () * 1000, 0), 4) AS COMMISSION
    FROM 
        XXSRF.XXSRF_SA_NPR_VALUES NPR,
        FREIGHT_DATA FD_OTHER,
        FREIGHT_DATA FD_COMMISSION,
        VOLUME_DATA VD
    WHERE 
        NPR.BUSINESS_UNIT = FD_OTHER.BUSINESS_UNIT
        AND NPR.PRODUCT_SEGMENT = FD_OTHER.PROD
        AND FD_OTHER.CATEGORY = 'OTHER'
        AND NPR.BUSINESS_UNIT = FD_COMMISSION.BUSINESS_UNIT
        AND NPR.PRODUCT_SEGMENT = FD_COMMISSION.PROD
        AND FD_COMMISSION.CATEGORY = 'COMMISSION'
        AND NPR.BUSINESS_UNIT = VD.BUSINESS_UNIT
        AND NPR.PRODUCT_SEGMENT = VD.PROD
) TEMP
WHERE TEMP.ORGANIZATION_ID = XXSRF.XXSRF_SA_NPR_VALUES.ORGANIZATION_ID
  AND TEMP.ORG_ID = XXSRF.XXSRF_SA_NPR_VALUES.ORG_ID
  AND TEMP.BSV = XXSRF.XXSRF_SA_NPR_VALUES.BSV
  AND TEMP.ORGANIZATION_CODE = XXSRF.XXSRF_SA_NPR_VALUES.ORGANIZATION_CODE
  AND TEMP.PRODUCT_SEGMENT = XXSRF.XXSRF_SA_NPR_VALUES.PRODUCT_SEGMENT
  AND TEMP.PERIOD_NAME = XXSRF.XXSRF_SA_NPR_VALUES.PERIOD_NAME
  AND TEMP.MIS_CATEGORY = XXSRF.XXSRF_SA_NPR_VALUES.MIS_CATEGORY
  AND TEMP.TRX_DATE = XXSRF.XXSRF_SA_NPR_VALUES.TRX_DATE
  AND TEMP.TRX_NUMBER = XXSRF.XXSRF_SA_NPR_VALUES.TRX_NUMBER
  AND TEMP.MARKET_TYPE = XXSRF.XXSRF_SA_NPR_VALUES.MARKET_TYPE
  AND TEMP.ITEM_CODE = XXSRF.XXSRF_SA_NPR_VALUES.ITEM_CODE
  AND TEMP.CUSTOMER_NAME = XXSRF.XXSRF_SA_NPR_VALUES.CUSTOMER_NAME
  AND TEMP.SALES_QTY_MT = XXSRF.XXSRF_SA_NPR_VALUES.SALES_QTY_MT
  AND TEMP.SALE_VALUE = XXSRF.XXSRF_SA_NPR_VALUES.SALE_VALUE
  AND TEMP.GROSS_NPR = XXSRF.XXSRF_SA_NPR_VALUES.GROSS_NPR
SET 
    XXSRF.XXSRF_SA_NPR_VALUES.NET_NPR = TEMP.NET_NPR,
    XXSRF.XXSRF_SA_NPR_VALUES.FREIGHT_AND_HANDLING = TEMP.FREIGHT_AND_HANDLING