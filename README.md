SELECT
    ORGANIZATION_ID,
    CASE
        WHEN PROD_TYPE LIKE '%J%' THEN 'JUMBO'
        WHEN PROD_TYPE LIKE '%M%' THEN 'MET'
    END AS PROD_TYPE,
    LINE_TYPE,
    TRX_DATE,
    BATCH_NO,
    ITEM_CODE,
    CASE
        WHEN LINE_TYPE = 1 THEN ABS(TOTAL_QTY)
        ELSE NULL
    END AS PRODUCT_QTY,
    CASE
        WHEN LINE_TYPE = -1 THEN ABS(TOTAL_QTY)
        ELSE NULL
    END AS INPUT_QTY
FROM (
    SELECT
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE,
        SUM(TRX_QTY) AS TOTAL_QTY
    FROM
        XXSRF.JUMBO_MET_TRANSACTIONS
    WHERE
        LINE_TYPE IN (1, -1)
    GROUP BY
        ORGANIZATION_ID,
        PROD_TYPE,
        LINE_TYPE,
        TRX_DATE,
        BATCH_NO,
        ITEM_CODE
) T
WHERE
    ORGANIZATION_ID = :ORGANIZATION_ID
    AND TRX_DATE = :TRX_DATE
ORDER BY
    ORGANIZATION_ID,
    TRX_DATE,
    BATCH_NO,
    LINE_TYPE;
